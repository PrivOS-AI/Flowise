############################################################################################################
####################################### FLOWISE QUEUE MODE CONFIG ##########################################
############################################################################################################
#
# This .env file is optimized for docker-compose-queue-source.yml
# Queue mode splits the main server (API) from workers (job execution)
# Perfect for: Production, High traffic, Scalability
#
# Usage:
#   docker-compose -f docker-compose-queue-source.yml --env-file .env.queue-source up --build -d
#
############################################################################################################

############################################################################################################
############################################## BASIC SETTINGS ##############################################
############################################################################################################

# Main server port (API endpoints)
PORT=3000

# Worker health check port
WORKER_PORT=5566


############################################################################################################
############################################## DATABASE ####################################################
############################################################################################################
#
# IMPORTANT: For production, use PostgreSQL/MySQL, NOT SQLite!
# SQLite is only for development/testing
#

# Option 1: SQLite (Development Only - NOT recommended for production)
DATABASE_PATH=/root/.flowise

# Option 2: PostgreSQL (RECOMMENDED for Production)
DATABASE_TYPE=postgres
DATABASE_HOST=your-postgres-host      # e.g., localhost, postgres, or RDS endpoint
DATABASE_PORT=5432
DATABASE_NAME=flowise
DATABASE_USER=flowise
DATABASE_PASSWORD=your-secure-password-here

# Option 3: MySQL/MariaDB
# DATABASE_TYPE=mysql  # or mariadb
# DATABASE_HOST=your-mysql-host
# DATABASE_PORT=3306
# DATABASE_NAME=flowise
# DATABASE_USER=flowise
# DATABASE_PASSWORD=your-secure-password-here

# SSL Connection (for cloud databases like RDS, Azure DB)
# DATABASE_SSL=true
# DATABASE_REJECT_UNAUTHORIZED=true
# DATABASE_SSL_KEY_BASE64=<your-base64-encoded-certificate>


############################################################################################################
############################################## SECRET KEYS #################################################
############################################################################################################
#
# CRITICAL: Change these values in production!
# Generate strong random values for all secrets
#

# Encryption key storage
SECRETKEY_PATH=/root/.flowise
# FLOWISE_SECRETKEY_OVERWRITE=your-custom-encryption-key-here

# AWS Secrets Manager (optional - for enterprise)
# SECRETKEY_STORAGE_TYPE=aws
# SECRETKEY_AWS_ACCESS_KEY=AKIA...
# SECRETKEY_AWS_SECRET_KEY=...
# SECRETKEY_AWS_REGION=us-east-1
# SECRETKEY_AWS_NAME=FlowiseEncryptionKey


############################################################################################################
############################################## LOGGING #####################################################
############################################################################################################

# Enable debug logs (set to false in production)
DEBUG=false

# Log storage path
LOG_PATH=/root/.flowise/logs

# Log level: error | warn | info | verbose | debug
LOG_LEVEL=info

# Custom function dependencies (security consideration)
# TOOL_FUNCTION_BUILTIN_DEP=crypto,fs
# TOOL_FUNCTION_EXTERNAL_DEP=
# ALLOW_BUILTIN_DEP=false


############################################################################################################
############################################## STORAGE #####################################################
############################################################################################################

# Storage type: local | s3 | gcs
STORAGE_TYPE=local
BLOB_STORAGE_PATH=/root/.flowise/storage

# AWS S3 Storage (for production with multiple workers)
# STORAGE_TYPE=s3
# S3_STORAGE_BUCKET_NAME=your-flowise-bucket
# S3_STORAGE_ACCESS_KEY_ID=AKIA...
# S3_STORAGE_SECRET_ACCESS_KEY=...
# S3_STORAGE_REGION=us-east-1
# S3_ENDPOINT_URL=  # For S3-compatible services like MinIO
# S3_FORCE_PATH_STYLE=false

# Google Cloud Storage
# STORAGE_TYPE=gcs
# GOOGLE_CLOUD_STORAGE_CREDENTIAL=/path/to/keyfile.json
# GOOGLE_CLOUD_STORAGE_PROJ_ID=your-gcp-project-id
# GOOGLE_CLOUD_STORAGE_BUCKET_NAME=your-bucket-name
# GOOGLE_CLOUD_UNIFORM_BUCKET_ACCESS=true


############################################################################################################
############################################## GENERAL SETTINGS ############################################
############################################################################################################

# Number of reverse proxies (important for rate limiting)
NUMBER_OF_PROXIES=1

# CORS settings (restrict in production!)
CORS_ORIGINS=*  # Change to: https://yourdomain.com
IFRAME_ORIGINS=*  # Change to: https://yourdomain.com

# File upload size limit
FLOWISE_FILE_SIZE_LIMIT=50mb

# Show community nodes
SHOW_COMMUNITY_NODES=true

# Disable telemetry
DISABLE_FLOWISE_TELEMETRY=true

# Disable specific nodes (comma-separated)
# DISABLED_NODES=

# Custom model list config
# MODEL_LIST_CONFIG_JSON=/path/to/models.json


############################################################################################################
############################################ AUTHENTICATION ################################################
############################################################################################################

# Application URL (used for email links, SSO callbacks)
APP_URL=http://localhost:3000  # Change to: https://yourdomain.com

# Basic Auth (Simple username/password for open source mode)
# FLOWISE_USERNAME=admin
# FLOWISE_PASSWORD=test1234

# JWT Configuration (CRITICAL: Change these in production!)
# Generate strong random strings: openssl rand -base64 32
JWT_AUTH_TOKEN_SECRET=CHANGE-THIS-TO-RANDOM-STRING-32-CHARS-MINIMUM
JWT_REFRESH_TOKEN_SECRET=CHANGE-THIS-TO-DIFFERENT-RANDOM-STRING-32-CHARS
JWT_ISSUER=flowise-issuer
JWT_AUDIENCE=flowise-users

# Token expiry times
JWT_TOKEN_EXPIRY_IN_MINUTES=360           # 6 hours
JWT_REFRESH_TOKEN_EXPIRY_IN_MINUTES=43200 # 30 days

# Expire all tokens on app restart (security feature)
EXPIRE_AUTH_TOKENS_ON_RESTART=false

# Express session secret
EXPRESS_SESSION_SECRET=your-express-session-secret-change-this

# Secure cookies (set true if using HTTPS)
SECURE_COOKIES=false  # Set to true in production with HTTPS

# Password & Token Settings
PASSWORD_RESET_TOKEN_EXPIRY_IN_MINS=15
PASSWORD_SALT_HASH_ROUNDS=10
TOKEN_HASH_SECRET=your-token-hash-secret-change-this

# Invitation token expiry
INVITE_TOKEN_EXPIRY_IN_HOURS=24

# Custom email templates
# WORKSPACE_INVITE_TEMPLATE_PATH=/path/to/workspace_invite.hbs


############################################################################################################
############################################## EMAIL (SMTP) ################################################
############################################################################################################

# Email configuration (required for user invitations, password resets)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# SMTP_SECURE=false  # true for port 465, false for 587
# ALLOW_UNAUTHORIZED_CERTS=false
# SENDER_EMAIL=noreply@yourdomain.com


############################################################################################################
############################################# ENTERPRISE ###################################################
############################################################################################################

# Enterprise Edition License (if you have one)
# LICENSE_URL=https://api.flowiseai.com
# FLOWISE_EE_LICENSE_KEY=your-enterprise-license-key
# OFFLINE=false


############################################################################################################
########################################### QUEUE CONFIGURATION ############################################
############################################################################################################
#
# CRITICAL: Queue mode requires Redis!
# This is what makes queue mode work - main server sends jobs to Redis, workers pick them up
#

# Enable queue mode
MODE=queue

# Queue name (must match between main and workers)
QUEUE_NAME=flowise-queue

# Redis connection (using service name from docker-compose)
REDIS_URL=redis://redis:6379

# Alternative: Individual Redis settings (if not using REDIS_URL)
# REDIS_HOST=redis
# REDIS_PORT=6379
# REDIS_USERNAME=
# REDIS_PASSWORD=
# REDIS_TLS=false

# Redis SSL/TLS (for cloud Redis like AWS ElastiCache, Redis Cloud)
# REDIS_TLS=true
# REDIS_CERT=
# REDIS_KEY=
# REDIS_CA=
# REDIS_KEEP_ALIVE=30000

# Queue configuration
QUEUE_REDIS_EVENT_STREAM_MAX_LEN=100000
WORKER_CONCURRENCY=10  # Number of concurrent jobs per worker
REMOVE_ON_AGE=86400    # Remove completed jobs after 24 hours
REMOVE_ON_COUNT=10000  # Keep max 10k completed jobs

# BullMQ Dashboard (useful for monitoring)
ENABLE_BULLMQ_DASHBOARD=true
# Access at: http://localhost:3000/admin/queues


############################################################################################################
########################################### METRICS & MONITORING ###########################################
############################################################################################################

# PostHog analytics (optional)
# POSTHOG_PUBLIC_API_KEY=

# Prometheus metrics
ENABLE_METRICS=false
# METRICS_PROVIDER=prometheus  # prometheus | open_telemetry
# METRICS_INCLUDE_NODE_METRICS=true
# METRICS_SERVICE_NAME=Flowise

# OpenTelemetry (if using METRICS_PROVIDER=open_telemetry)
# METRICS_OPEN_TELEMETRY_METRIC_ENDPOINT=http://localhost:4318/v1/metrics
# METRICS_OPEN_TELEMETRY_PROTOCOL=http  # http | grpc | proto
# METRICS_OPEN_TELEMETRY_DEBUG=false


############################################################################################################
############################################### PROXY ######################################################
############################################################################################################

# Corporate proxy settings (if behind firewall)
# GLOBAL_AGENT_HTTP_PROXY=http://proxy.corp.com:8080
# GLOBAL_AGENT_HTTPS_PROXY=http://proxy.corp.com:8080
# GLOBAL_AGENT_NO_PROXY=localhost,127.0.0.1


############################################################################################################
############################################## SECURITY ####################################################
############################################################################################################

# Trust proxy headers (important for getting real client IPs)
TRUST_PROXY=true

# HTTP deny list (block specific URLs/patterns)
# HTTP_DENY_LIST=

# MCP (Model Context Protocol) security
# CUSTOM_MCP_SECURITY_CHECK=true
# CUSTOM_MCP_PROTOCOL=sse  # stdio | sse


############################################################################################################
############################################# NOTES ########################################################
############################################################################################################
#
# PRODUCTION CHECKLIST:
# ✅ 1. Change DATABASE_TYPE from SQLite to PostgreSQL
# ✅ 2. Generate strong random JWT secrets (use: openssl rand -base64 32)
# ✅ 3. Set APP_URL to your domain (https://yourdomain.com)
# ✅ 4. Configure SMTP for email notifications
# ✅ 5. Restrict CORS_ORIGINS to your domain only
# ✅ 6. Set SECURE_COOKIES=true if using HTTPS
# ✅ 7. Configure Redis connection (already set for docker-compose)
# ✅ 8. Set DEBUG=false and LOG_LEVEL=info
# ✅ 9. Consider using S3/GCS for storage in multi-worker setup
# ✅ 10. Enable metrics for monitoring (Prometheus/OpenTelemetry)
#
# SCALING TIPS:
# - Increase WORKER_CONCURRENCY for more parallel job processing
# - Run multiple worker containers (docker-compose up --scale flowise-worker=3)
# - Use external PostgreSQL (RDS, Cloud SQL) for better performance
# - Use S3/GCS storage when running multiple workers
# - Set up Redis cluster for high availability
#
############################################################################################################
